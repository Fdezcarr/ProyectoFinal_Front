<div class="container">

    <form (ngSubmit)="crearUsuario()" class="row g-3 mt-3">
        <div class="col-md-3 col-sm-6">
            <input
                [(ngModel)]="nuevoUsuario.nombre"
                name="nombre"
                class="form-control"
                placeholder="Nombre"
                required
            />
        </div>
        <div class="col-md-3 col-sm-6">
            <input
                [(ngModel)]="nuevoUsuario.apellido"
                name="apellido"
                class="form-control"
                placeholder="Apellido"
                required
            />
        </div>
        <div class="col-md-3 col-sm-6">
            <input
                [(ngModel)]="nuevoUsuario.email"
                name="email"
                class="form-control"
                placeholder="Email"
                required
            />
            <div *ngIf="emailDuplicado" class="text-danger">
                El email ya está registrado
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <input
                [(ngModel)]="nuevoUsuario.password"
                name="password"
                class="form-control"
                placeholder="Contraseña"
                required
            />
        </div>
        <div class="col-md-3 col-sm-6">
            <select
                [(ngModel)]="nuevoUsuario.rol"
                name="rol"
                class="form-select"
                required
                (change)="selectUsuarioRol($event)"
            >
                <option value="" disabled>Seleccione un rol</option>
                <option value="jefe">Jefe</option>
                <option value="operario">Operario</option>
                <option value="encargado">Encargado</option>
            </select>
        </div>
        <div class="col-md-3 col-sm-6">
            <select
                [(ngModel)]="nuevoUsuario.almacen_id"
                name="almacen_id"
                class="form-select"
                required
            >
                <option value="" disabled>
                    Seleccione un almacén
                </option>
                <option *ngFor="let almacen of almacenes" [value]="almacen.id">
                    {{ almacen.nombre }}
                </option>
            </select>
        </div>
        <div class="col-12 text-center">
            <button type="submit" class="btn btn-primary">
                Agregar Usuario
            </button>
        </div>
    </form>

    <table class="table mt-4">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Email</th>
                <th>Contraseña</th>
                <th>Rol</th>
                <th>Almacén</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let usuario of usuarios">
                <td>{{ usuario.nombre }}</td>
                <td>{{ usuario.apellido }}</td>
                <td>{{ usuario.email }}</td>
                <td>******</td>
                <td>{{ usuario.rol }}</td>
                <td>{{ usuario.almacen_id }}</td>
                <td>
                    <button
                        class="btn btn-warning btn-sm"
                        (click)="abrirModalUsuario(usuario)"
                    >
                        Editar
                    </button>
                    <button
                        class="btn btn-danger btn-sm"
                        (click)="eliminarUsuario(usuario.id)"
                    >
                        Eliminar
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <div *ngIf="usuarioSeleccionado" class="modal">
        <div class="modal-content">
            <h3>Editar Usuario</h3>
            <input
                [(ngModel)]="usuarioSeleccionado.nombre"
                class="form-control"
                placeholder="Nombre"
            />
            <input
                [(ngModel)]="usuarioSeleccionado.apellido"
                class="form-control"
                placeholder="Apellido"
            />
            <input
                [(ngModel)]="usuarioSeleccionado.email"
                class="form-control"
                placeholder="Email"
            />

            <select [(ngModel)]="usuarioSeleccionado.rol" class="form-select">
                <option value="" disabled>Seleccione un rol</option>
                <option value="jefe">Jefe</option>
                <option value="operario">Operario</option>
                <option value="encargado">Encargado</option>
            </select>

            <select
                [(ngModel)]="usuarioSeleccionado.almacen_id"
                class="form-select"
            >
                <option value="" disabled selected>
                    Seleccione un almacén
                </option>
                <option *ngFor="let almacen of almacenes" [value]="almacen.id">
                    {{ almacen.nombre }}
                </option>
            </select>

            <div class="modal-actions">
                <button
                    class="btn btn-success"
                    (click)="guardarUsuarioEditado()"
                >
                    Guardar
                </button>
                <button
                    class="btn btn-secondary"
                    (click)="usuarioSeleccionado = null"
                >
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <h2>Gestión de Almacenes</h2>

    <form (ngSubmit)="crearAlmacen()" class="row g-3 mt-3">
        <div class="col-md-6">
            <input
                [(ngModel)]="nuevoAlmacen.nombre"
                name="nombre"
                class="form-control"
                placeholder="Nombre del Almacén"
                required
            />
        </div>
        <div class="col-md-6">
            <input
                [(ngModel)]="nuevoAlmacen.localizacion"
                name="localizacion"
                class="form-control"
                placeholder="Localización"
                required
            />
        </div>
        <div class="col-12 text-center">
            <button type="submit" class="btn btn-primary">
                Agregar Almacén
            </button>
        </div>
    </form>

    <table class="table mt-4">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Localización</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let almacen of almacenes">
                <td>{{ almacen.nombre }}</td>
                <td>{{ almacen.localizacion }}</td>
                <td>
                    <button
                        class="btn btn-warning btn-sm"
                        (click)="abrirModalAlmacen(almacen)"
                    >
                        Editar
                    </button>
                    <button
                        class="btn btn-danger btn-sm"
                        (click)="eliminarAlmacen(almacen.id)"
                    >
                        Eliminar
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
    <div *ngIf="almacenSeleccionado" class="modal">
        <div class="modal-content">
            <h3>Editar Almacén</h3>
            <input
                [(ngModel)]="almacenSeleccionado.nombre"
                class="form-control"
                placeholder="Nombre"
            />
            <input
                [(ngModel)]="almacenSeleccionado.localizacion"
                class="form-control"
                placeholder="Localización"
            />
            <div class="modal-actions">
                <button
                    class="btn btn-success"
                    (click)="guardarAlmacenEditado()"
                >
                    Guardar
                </button>
                <button
                    class="btn btn-secondary"
                    (click)="almacenSeleccionado = null"
                >
                    Cancelar
                </button>
            </div>
        </div>
    </div>
</div>
